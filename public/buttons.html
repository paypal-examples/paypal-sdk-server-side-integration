<html>
  <head>
    <meta charset="UTF-8" />
    <title>PayPal Buttons Demo</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <script src="https://unpkg.com/@paypal/paypal-js@5.1.4/dist/iife/paypal-js.min.js"></script>
  </head>
  <body>
    <h1>PayPal Buttons Example</h1>
    <div id="paypal-buttons-container"></div>
    <script>
      function loadPayPalSDK() {
        return fetch("/api/paypal/client-config")
          .then((response) => response.json())
          .then(({ clientID, webBaseUrl }) => {
            return paypalLoadScript({
              "client-id": clientID,
              sdkBaseURL: `${webBaseUrl}/sdk/js`,
            });
          });
      }

      loadPayPalSDK().then(() => {
        window.paypal
          .Buttons({
            createOrder() {
              return fetch("/api/paypal/create-order", {
                method: "post",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  cart: [
                    {
                      // change this to "PRODUCT_789" to force an error
                      sku: "PRODUCT_123",
                      quantity: 2,
                    },
                  ],
                }),
              })
                .then((response) => response.json())
                .then((order) => order.id);
            },
            onShippingChange(data) {
              console.log(data);
              return fetch("/api/paypal/patch-order", {
                method: "PATCH",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  orderID: data.orderID,
                  selectedShippingOption: data.selected_shipping_option
                }),
              }).then((response) => response.json());
            },
          })
          .render("#paypal-buttons-container")
          .catch((error) => {
            console.error("failed to render the PayPal Buttons", error);
          });
      });
    </script>
  </body>
</html>
